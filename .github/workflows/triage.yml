name: New Issues Triage Assignment
concurrency: 1
on:
  issues:
    types: [opened, reopened]

jobs:
  label-and-assign:
    name: Label And Assign Issue
    runs-on: ubuntu-latest
    steps:

      - uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.8

      - name: Install Dependencies
        run: |
          pip install pygithub
          touch .last_account_assigned

      - name: Set up cache
        uses: actions/cache@v2
        with:
          path: .last-user-assigned
          key: cache-${{ hashFiles('.last-user-assigned') }}

      - name: Label And Assign Issue
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          READ_ORG_TOKEN: ${{ secrets.READ_ORG_TEAM_MEMBERS_ISSUE_TRIAGE }}
        run: |
          python .github/workflows/scripts/label-and-assign.py \
            --org ${{ github.repository_owner }} \
            --repo ${{ github.event.repository.name }} \
            --team team-core \
            --label needs-triage \
            --issue ${{ github.event.issue.number }}
